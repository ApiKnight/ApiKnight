import{R as y,r as o,C as ie,c as U,ak as ve,al as Ce,g as je,m as Ee,b as Me,am as Ne,an as Ie,a as ce,ao as Pe,ap as de,aq as ze,ar as Le,S as Oe,k as D,j as i,ai as Be,d as we,q as _e,B as G,M as Ae,H as me,as as He,at as Te,a6 as I,au as ke}from"./index-8a3e701d.js";import{P as Re}from"./index-5c7aacb3.js";const re=y.createContext({});re.Consumer;var ue=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};const We=t=>{var{prefixCls:e,className:n,avatar:r,title:s,description:m}=t,f=ue(t,["prefixCls","className","avatar","title","description"]);const{getPrefixCls:b}=o.useContext(ie),h=b("list",e),S=U(`${h}-item-meta`,n),v=y.createElement("div",{className:`${h}-item-meta-content`},s&&y.createElement("h4",{className:`${h}-item-meta-title`},s),m&&y.createElement("div",{className:`${h}-item-meta-description`},m));return y.createElement("div",Object.assign({},f,{className:S}),r&&y.createElement("div",{className:`${h}-item-meta-avatar`},r),(s||m)&&v)},Ge=(t,e)=>{var{prefixCls:n,children:r,actions:s,extra:m,className:f,colStyle:b}=t,h=ue(t,["prefixCls","children","actions","extra","className","colStyle"]);const{grid:S,itemLayout:v}=o.useContext(re),{getPrefixCls:L}=o.useContext(ie),d=()=>{let l;return o.Children.forEach(r,j=>{typeof j=="string"&&(l=!0)}),l&&o.Children.count(r)>1},M=()=>v==="vertical"?!!m:!d(),p=L("list",n),C=s&&s.length>0&&y.createElement("ul",{className:`${p}-item-action`,key:"actions"},s.map((l,j)=>y.createElement("li",{key:`${p}-item-action-${j}`},l,j!==s.length-1&&y.createElement("em",{className:`${p}-item-action-split`})))),N=S?"div":"li",O=y.createElement(N,Object.assign({},h,S?{}:{ref:e},{className:U(`${p}-item`,{[`${p}-item-no-flex`]:!M()},f)}),v==="vertical"&&m?[y.createElement("div",{className:`${p}-item-main`,key:"content"},r,C),y.createElement("div",{className:`${p}-item-extra`,key:"extra"},m)]:[r,C,ve(m,{key:"extra"})]);return S?y.createElement(Ce,{ref:e,flex:1,style:b},O):O},he=o.forwardRef(Ge);he.Meta=We;const De=he,Xe=t=>{const{listBorderedCls:e,componentCls:n,paddingLG:r,margin:s,itemPaddingSM:m,itemPaddingLG:f,marginLG:b,borderRadiusLG:h}=t;return{[`${e}`]:{border:`${t.lineWidth}px ${t.lineType} ${t.colorBorder}`,borderRadius:h,[`${n}-header,${n}-footer,${n}-item`]:{paddingInline:r},[`${n}-pagination`]:{margin:`${s}px ${b}px`}},[`${e}${n}-sm`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:m}},[`${e}${n}-lg`]:{[`${n}-item,${n}-header,${n}-footer`]:{padding:f}}}},Fe=t=>{const{componentCls:e,screenSM:n,screenMD:r,marginLG:s,marginSM:m,margin:f}=t;return{[`@media screen and (max-width:${r})`]:{[`${e}`]:{[`${e}-item`]:{[`${e}-item-action`]:{marginInlineStart:s}}},[`${e}-vertical`]:{[`${e}-item`]:{[`${e}-item-extra`]:{marginInlineStart:s}}}},[`@media screen and (max-width: ${n})`]:{[`${e}`]:{[`${e}-item`]:{flexWrap:"wrap",[`${e}-action`]:{marginInlineStart:m}}},[`${e}-vertical`]:{[`${e}-item`]:{flexWrap:"wrap-reverse",[`${e}-item-main`]:{minWidth:t.contentWidth},[`${e}-item-extra`]:{margin:`auto auto ${f}px`}}}}}},qe=t=>{const{componentCls:e,antCls:n,controlHeight:r,minHeight:s,paddingSM:m,marginLG:f,padding:b,itemPadding:h,colorPrimary:S,itemPaddingSM:v,itemPaddingLG:L,paddingXS:d,margin:M,colorText:p,colorTextDescription:C,motionDurationSlow:N,lineWidth:O,headerBg:l,footerBg:j,emptyTextPadding:T,metaMarginBottom:_,avatarMarginRight:A,titleMarginBottom:P,descriptionFontSize:X}=t,k={};return["start","center","end"].forEach(R=>{k[`&-align-${R}`]={textAlign:R}}),{[`${e}`]:Object.assign(Object.assign({},Me(t)),{position:"relative","*":{outline:"none"},[`${e}-header`]:{background:l},[`${e}-footer`]:{background:j},[`${e}-header, ${e}-footer`]:{paddingBlock:m},[`${e}-pagination`]:Object.assign(Object.assign({marginBlockStart:f},k),{[`${n}-pagination-options`]:{textAlign:"start"}}),[`${e}-spin`]:{minHeight:s,textAlign:"center"},[`${e}-items`]:{margin:0,padding:0,listStyle:"none"},[`${e}-item`]:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:h,color:p,[`${e}-item-meta`]:{display:"flex",flex:1,alignItems:"flex-start",maxWidth:"100%",[`${e}-item-meta-avatar`]:{marginInlineEnd:A},[`${e}-item-meta-content`]:{flex:"1 0",width:0,color:p},[`${e}-item-meta-title`]:{margin:`0 0 ${t.marginXXS}px 0`,color:p,fontSize:t.fontSize,lineHeight:t.lineHeight,"> a":{color:p,transition:`all ${N}`,"&:hover":{color:S}}},[`${e}-item-meta-description`]:{color:C,fontSize:X,lineHeight:t.lineHeight}},[`${e}-item-action`]:{flex:"0 0 auto",marginInlineStart:t.marginXXL,padding:0,fontSize:0,listStyle:"none","& > li":{position:"relative",display:"inline-block",padding:`0 ${d}px`,color:C,fontSize:t.fontSize,lineHeight:t.lineHeight,textAlign:"center","&:first-child":{paddingInlineStart:0}},[`${e}-item-action-split`]:{position:"absolute",insetBlockStart:"50%",insetInlineEnd:0,width:O,height:Math.ceil(t.fontSize*t.lineHeight)-t.marginXXS*2,transform:"translateY(-50%)",backgroundColor:t.colorSplit}}},[`${e}-empty`]:{padding:`${b}px 0`,color:C,fontSize:t.fontSizeSM,textAlign:"center"},[`${e}-empty-text`]:{padding:T,color:t.colorTextDisabled,fontSize:t.fontSize,textAlign:"center"},[`${e}-item-no-flex`]:{display:"block"}}),[`${e}-grid ${n}-col > ${e}-item`]:{display:"block",maxWidth:"100%",marginBlockEnd:M,paddingBlock:0,borderBlockEnd:"none"},[`${e}-vertical ${e}-item`]:{alignItems:"initial",[`${e}-item-main`]:{display:"block",flex:1},[`${e}-item-extra`]:{marginInlineStart:f},[`${e}-item-meta`]:{marginBlockEnd:_,[`${e}-item-meta-title`]:{marginBlockStart:0,marginBlockEnd:P,color:p,fontSize:t.fontSizeLG,lineHeight:t.lineHeightLG}},[`${e}-item-action`]:{marginBlockStart:b,marginInlineStart:"auto","> li":{padding:`0 ${b}px`,"&:first-child":{paddingInlineStart:0}}}},[`${e}-split ${e}-item`]:{borderBlockEnd:`${t.lineWidth}px ${t.lineType} ${t.colorSplit}`,"&:last-child":{borderBlockEnd:"none"}},[`${e}-split ${e}-header`]:{borderBlockEnd:`${t.lineWidth}px ${t.lineType} ${t.colorSplit}`},[`${e}-split${e}-empty ${e}-footer`]:{borderTop:`${t.lineWidth}px ${t.lineType} ${t.colorSplit}`},[`${e}-loading ${e}-spin-nested-loading`]:{minHeight:r},[`${e}-split${e}-something-after-last-item ${n}-spin-container > ${e}-items > ${e}-item:last-child`]:{borderBlockEnd:`${t.lineWidth}px ${t.lineType} ${t.colorSplit}`},[`${e}-lg ${e}-item`]:{padding:L},[`${e}-sm ${e}-item`]:{padding:v},[`${e}:not(${e}-vertical)`]:{[`${e}-item-no-flex`]:{[`${e}-item-action`]:{float:"right"}}}}},Ve=je("List",t=>{const e=Ee(t,{listBorderedCls:`${t.componentCls}-bordered`,minHeight:t.controlHeightLG});return[qe(e),Xe(e),Fe(e)]},t=>({contentWidth:220,itemPadding:`${t.paddingContentVertical}px 0`,itemPaddingSM:`${t.paddingContentVerticalSM}px ${t.paddingContentHorizontal}px`,itemPaddingLG:`${t.paddingContentVerticalLG}px ${t.paddingContentHorizontalLG}px`,headerBg:"transparent",footerBg:"transparent",emptyTextPadding:t.padding,metaMarginBottom:t.padding,avatarMarginRight:t.padding,titleMarginBottom:t.paddingSM,descriptionFontSize:t.fontSize}));var Ke=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};function H(t){var e,{pagination:n=!1,prefixCls:r,bordered:s=!1,split:m=!0,className:f,rootClassName:b,style:h,children:S,itemLayout:v,loadMore:L,grid:d,dataSource:M=[],size:p,header:C,footer:N,loading:O=!1,rowKey:l,renderItem:j,locale:T}=t,_=Ke(t,["pagination","prefixCls","bordered","split","className","rootClassName","style","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]);const A=n&&typeof n=="object"?n:{},[P,X]=o.useState(A.defaultCurrent||1),[k,R]=o.useState(A.defaultPageSize||10),{getPrefixCls:J,renderEmpty:B,direction:Y,list:w}=o.useContext(ie),Q={current:1,total:0},F=c=>($,E)=>{var ae;X($),R(E),n&&n[c]&&((ae=n==null?void 0:n[c])===null||ae===void 0||ae.call(n,$,E))},Z=F("onChange"),a=F("onShowSizeChange"),g=(c,$)=>{if(!j)return null;let E;return typeof l=="function"?E=l(c):l?E=c[l]:E=c.key,E||(E=`list-item-${$}`),o.createElement(o.Fragment,{key:E},j(c,$))},z=()=>!!(L||n||N),u=J("list",r),[$e,fe]=Ve(u);let W=O;typeof W=="boolean"&&(W={spinning:W});const ee=W&&W.spinning;let q="";switch(p){case"large":q="lg";break;case"small":q="sm";break}const xe=U(u,{[`${u}-vertical`]:v==="vertical",[`${u}-${q}`]:q,[`${u}-split`]:m,[`${u}-bordered`]:s,[`${u}-loading`]:ee,[`${u}-grid`]:!!d,[`${u}-something-after-last-item`]:z(),[`${u}-rtl`]:Y==="rtl"},w==null?void 0:w.className,f,b,fe),x=Ne(Q,{total:M.length,current:P,pageSize:k},n||{}),oe=Math.ceil(x.total/x.pageSize);x.current>oe&&(x.current=oe);const se=n?o.createElement("div",{className:U(`${u}-pagination`,`${u}-pagination-align-${(e=x==null?void 0:x.align)!==null&&e!==void 0?e:"end"}`)},o.createElement(Ie,Object.assign({},x,{onChange:Z,onShowSizeChange:a}))):null;let te=ce(M);n&&M.length>(x.current-1)*x.pageSize&&(te=ce(M).splice((x.current-1)*x.pageSize,x.pageSize));const ye=Object.keys(d||{}).some(c=>["xs","sm","md","lg","xl","xxl"].includes(c)),le=Pe(ye),V=o.useMemo(()=>{for(let c=0;c<de.length;c+=1){const $=de[c];if(le[$])return $}},[le]),be=o.useMemo(()=>{if(!d)return;const c=V&&d[V]?d[V]:d.column;if(c)return{width:`${100/c}%`,maxWidth:`${100/c}%`}},[d==null?void 0:d.column,V]);let ne=ee&&o.createElement("div",{style:{minHeight:53}});if(te.length>0){const c=te.map(($,E)=>g($,E));ne=d?o.createElement(ze,{gutter:d.gutter},o.Children.map(c,$=>o.createElement("div",{key:$==null?void 0:$.key,style:be},$))):o.createElement("ul",{className:`${u}-items`},c)}else!S&&!ee&&(ne=o.createElement("div",{className:`${u}-empty-text`},T&&T.emptyText||(B==null?void 0:B("List"))||o.createElement(Le,{componentName:"List"})));const K=x.position||"bottom",Se=o.useMemo(()=>({grid:d,itemLayout:v}),[JSON.stringify(d),v]);return $e(o.createElement(re.Provider,{value:Se},o.createElement("div",Object.assign({style:Object.assign(Object.assign({},w==null?void 0:w.style),h),className:xe},_),(K==="top"||K==="both")&&se,C&&o.createElement("div",{className:`${u}-header`},C),o.createElement(Oe,Object.assign({},W),ne,S),N&&o.createElement("div",{className:`${u}-footer`},N),L||(K==="bottom"||K==="both")&&se)))}H.Item=De;const Ue=t=>D.post("v1/members/list",{projectid:t});const ge=t=>D.post("v1/invite/wlist",{projectid:t}),pe=t=>D.post("v1/invite/updatestatus",t,{}),Je=t=>D.post("v1/members/update",t,{}),Ye=(t,e)=>D.post("v1/members/delete",{project_id:t,user_id:e}),Qe=({project_id:t,user_id:e})=>D.post("/v1/members/convert",{project_id:t,user_id:e});const Ze=t=>i.jsxs("div",{className:"memberInfo",children:[i.jsx("h1",{children:t.data.count}),i.jsx("p",{children:t.data.label})]});const et=t=>{const e=[{key:"1",count:t.data.numberCount,label:"成员"},{key:"2",count:t.data.dNumberCount,label:"申请"}];return i.jsx("div",{className:"showMember",children:e.map(n=>i.jsx(Ze,{data:n},n.key))})},at=()=>{Be().start();const t=we().state,{project_id:e}=t,[n,r]=o.useState(!1),[s,m]=o.useState(!0),[f,b]=o.useState(!1),[h,S]=o.useState(),[v,L]=o.useState([]),[d,M]=o.useState(0),[p,C]=o.useState(1);o.useEffect(()=>{ge(e).then(a=>{a.data.code===200&&M(a.data.data.length)})},[]);const[N,O]=o.useState(""),[l,j]=o.useState(0),T=()=>{_(),r(!0)},_=()=>{ge(e).then(a=>{a.data.code===200&&L(a.data.data.reverse())})};async function A(a){let g=await Te(a);g.data.code===200&&j(g.data.data.role),P()}const P=()=>Ue(e).then(a=>{if(a.data.code===200){let g=a.data.data;C(g.length),S(g.map(z=>(m(!1),z.key=z.user_id,z)))}});o.useEffect(()=>{A(e)},[]);const X=()=>{r(!1)},k=!s&&!f?i.jsx("div",{style:{textAlign:"center",marginTop:12,height:32,lineHeight:"32px"}}):null,R=a=>()=>{pe({projectid:e,status:"1",id:a}).then(z=>{z.data.code===200?(I.success("已同意"),_(),P()):I.error("操作失败")})},J=a=>()=>{pe({projectid:e,status:"-1",id:a}).then(z=>{z.data.code===200?(I.success("已拒绝"),_()):I.error("操作失败")})},B=a=>()=>{a==="admin"?Qe({user_id:N,project_id:e}).then(g=>{g.data.code===200?(I.success("修改成功"),A(e),P()):I.error("修改失败")}):Je({user_id:N,project_id:e,role:a==="member"?3:a==="operator"?2:a==="admin"?1:4}).then(g=>{g.data.code===200?(I.success("修改成功"),P()):I.error("修改失败")})},Y=[{label:i.jsx("div",{onClick:B("tourist"),children:"设为游客"}),key:"4"},{label:i.jsx("div",{onClick:B("member"),children:"设为成员"}),key:"3"},{label:i.jsx("div",{onClick:B("operator"),children:"设为管理者"}),key:"2"},{label:i.jsx("div",{onClick:B("admin"),children:"设为所有者"}),key:"1"}],w=a=>a===localStorage.getItem("user_id")?"":l===1?i.jsx(ke,{menu:{items:Y},trigger:["click"],children:i.jsx("a",{onClick:()=>O(a),children:"权限设置"})}):"",Q=a=>{Ye(e,a).then(g=>{g.data.code===200?(I.success("移除成功"),P()):I.error("移除失败")})},F=(a,g)=>g===localStorage.getItem("user_id")?"":l<a&&l!==0?i.jsx(Re,{title:"谨慎操作！",description:"确定移除该成员吗?",onConfirm:()=>{Q(g)},okText:"确定",cancelText:"取消",children:i.jsx(G,{danger:!0,children:"移除"})}):"",Z={numberCount:p,dNumberCount:d};return i.jsx(_e,{children:i.jsxs("div",{className:"membermgt",children:[i.jsx(et,{data:Z}),l===1||l===2?i.jsxs("div",{className:"apply",children:[i.jsxs("div",{className:"title-wrap",children:[i.jsx("h3",{children:"成员管理"}),i.jsx(G,{type:"primary",onClick:T,className:"button",children:"审批列表"})]}),i.jsx("div",{children:i.jsx(Ae,{title:"申请人",open:n,onCancel:X,footer:null,children:i.jsx(H,{className:"list",loading:s,itemLayout:"horizontal",dataSource:v,renderItem:a=>i.jsx(H.Item,{actions:[i.jsx(i.Fragment,{children:a.status===0?i.jsxs(i.Fragment,{children:[i.jsx(G,{type:"primary",danger:!0,onClick:J(a.id),disabled:l!==1&&l!==2,children:"拒绝"}),",",i.jsx(G,{type:"primary",onClick:R(a.id),disabled:l!==1&&l!==2,children:"同意"})]}):a.status===1?i.jsx(G,{disabled:!0,type:"default",children:"已同意"}):a.status===-1?i.jsx(G,{disabled:!0,type:"primary",style:{backgroundColor:"red",opacity:"50%",color:"black"},children:"已拒绝"}):""})],children:i.jsx(me,{avatar:!0,title:!1,loading:s,active:!0,children:i.jsx(H.Item.Meta,{title:a.name})})},a.id)})})})]}):"",i.jsx("div",{className:"apply-modal",children:i.jsx(H,{className:"list",loading:s,itemLayout:"horizontal",loadMore:k,dataSource:h,renderItem:a=>i.jsx(H.Item,{actions:[w(a.user_id),F(a.role,a.user_id)],children:i.jsx(me,{avatar:!0,title:!1,loading:s,active:!0,children:i.jsx(H.Item.Meta,{avatar:i.jsx(He,{src:a.avatar_url,alt:"头像"}),title:a.name,description:`身份：${a.role===1?"管理者":a.role===2?"管理员":a.role===3?"成员":"游客"}`})})},a.user_id)})})]})})};export{at as default};
